---
title: Spring-step5-从配置文件读取Bean信息的容器
date: 2022-05-01 +/-TTTT
categories: [造轮子,Spring]
tags: [系统设计,封装,反射]     # TAG names should always be lowercase
---

## 回顾
到目前为止spring-bean容器也来越自动化，它能够为客户端做的事情越来越多，包括自动创建Bean对象、对象属性自动注入；我们前面说过的一个Bean容器应该具备的能力：

- Bean定义
- Bean注册，所谓的注册就像DriveManger对数据库驱动进行注册的那样，实际就是将Bean或者与Bean直接关联的信息用容器进行保存，待要使用时就用索引（可以是名称、id、或其他任何能够唯一对应Bean的事务）取出
- Bean对象创建
- 依赖注入

目前该容器已经全部具备，但是与实际的Spring-Bean相比，它还有个地方很有违和感：客户端每次都需要依靠Java代码把BeanDefinition和PropertyValues给准备好，并且注册进入容器，但实际上这样操作比较麻烦，毕竟记住API是件非常烦人的事情，所以实际的Spring容器采用配置文件记录bean信息的方法，通过读取配置文件解析成BeanDefinition和PropertyValues，这样容器就将BeanDefinition和PropertyValues创建工作也包揽在自己手里，这样客户端的工作就更加轻松了；

## 目标
所以本step的目标就是实现读取xml配置文件，实现容器自动创建BeanDefinition和PropertyValues！

## 当前的Bean容器
![当前的容器和期望的容器](/blog/202205021443694.png "当前的容器和期望的容器")

可以看到客户端不用管BeanDefinition和PropertyValues的实例化，XML配置文件彻底接管了这个任务，这下我们其实可以把XML配置文件和Bean容器合并一下作为最新的容器，**从客户端的角度来看只需要从Bean容器中get，而不用set了**，这样客户端差不多把对象的控制权完全交给了Bean容器，也就实现了对象实例化逻辑和客户端核心业务解耦的目的，而从容器的角度来看，生产对象实例的原料由XML配置文件提供，Bean容器负责制造，整个合在一起构造了一个严谨的对象实例化工厂；

![实例化工厂支持客户端核心业务](/blog/202205021449454.png "实例化工厂支持客户端核心业务")

## 怎么从原始容器——>期望容器
当前容器，Bean定义和Bean注册还需要客户端操劳，应该为了让客户端轻松点，就让Bean容器来代劳吧；

也就是说Bean容器现在要做的工作就有：Bean定义 ——> Bean注册 ——> Bean实例化 ——> Bean属性注入；不过在这之前得准备原料，才能准备生产得事情吧，哈哈哈，不急慢慢来！所以工作有点多啊：

准备原料 ——> Bean定义 ——> Bean注册 ——> Bean实例化 ——> Bean属性注入

## 合理规划生产
所谓思考建设得时候不仅要考虑当前得情况，还要给未来留有余地，以便建设的扩展优化，所以我们是否要把所有的生产流程放在一个流水线上呢？当然不是，分部门，各司其职分而治之才是王道，因为这样各个流程不会杂糅在一起，要是针对其中一个流程做优化，也不会影响到其他的生产流程，**总之生产线分解再分解就对了**

### 原料引进部门
所以针对生产流程，成立专门的部门，原料引进部门专门处理XML配置文件读取，解析BeanDefinition的任务，毕竟BeanDefiniton就是我们需要的原料，下面看看原料加工厂需要做那些工作吧：

![原料加工成的工作](/blog/202205021733589.png "原料加工成的工作")

### 