---
title: 数据库
date: 2022-03-05 +/-TTTT
categories: [数据库, MySQL]
tags: []     # TAG names should always be lowercase
---

1.外键<br>
- 为了保证数据的一致性和正确性，我们往往会使用外键。例如1，在级联更新下，学生表中stu_id是主键，成绩表中stu_id是外键，如果在主表中stu_id发生变化，那么为了保证**一致性**从表中也会更新；例如2，当我们向成绩表中插入数据时，为了保证**正确性**会检查stu_id在学生表中是否存在，如果不存在则会插入失败；
- 创建成绩表时添加：`foreign key(stu_id) references t_student(stu_id)`；创建表后才添加：`ALTER TABLE t_score add constraint "t_score_fk1" foreign key(stu_id) references t_student(stu_id)`；
- 外键的优点
    + 保证了数据库数据的一致性和完整性；
    + 级联操作方便，减轻了程序代码量；
- 外键的缺点
    + 外键影响数据库的插入速度；
    + 级联更新是强阻塞，存在数据库更新风暴的风险；
- 使用外键存在的问题
    + 外键的主从关系是定的，但是需求确实变化的，如果字段不在需要与其他表关联就会增加麻烦；
    + 由于外键约束的存在，每次做级联更新和删除时都需要仔细考虑后果；
    + 外键还会因为需要请求对其他表内部加锁而容易出现死锁情况；
    + 对分库分表不友好 ：因为分库分表下外键是无法生效的；
- 外键的适用场景：外键与级联更新适用于单机低并发，不适合分布式、高并发集群；